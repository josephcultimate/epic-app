/*! person 05-06-2015 */
App.PersonController=Ember.ArrayController.extend({employees:[],managers:[],managersadmins:[],employeesadmins:[],employees_count:function(){return this.employees.get("length")}.property("@each.isEmployee"),managers_count:function(){return this.managers.get("length")}.property("@each.isManager"),managersadmins_count:function(){return this.managersadmins.get("length")}.property("@each.isManagerAdmin"),employeesadmins_count:function(){return this.employeesadmins.get("length")}.property("@each.isEmployeeAdmin"),empty:function(){return 0===this.employees.get("length")&&0===this.managers.get("length")&&0===this.managersadmins.get("length")&&0===this.employeesadmins.get("length")}.property("length"),sortProperties:["first_name:asc"],sortedEmployees:Ember.computed.sort("employees","sortProperties"),sortedManagers:Ember.computed.sort("managers","sortProperties"),sortedManagersAdmins:Ember.computed.sort("managersadmins","sortProperties"),sortedEmployeesAdmins:Ember.computed.sort("employeesadmins","sortProperties"),sortedModel:Ember.computed.sort("model","sortProperties"),msg_warning:null,_linkToProfile:function(a){var b=this;b.send("resetmsg");var c={username:"test"},d=App.PostRequest.create({endpointRoute:"/login",data:JSON.stringify(c)}),e=a.get("id"),f=App.post(d);f.then(b.onLoginSuccess(e),this.onLoginError())},onLoginSuccess:function(a){var b=this;return function(c){App.setSessionToken(c.session_token);var d=b.get("attemptedTransition");d?(d.retry(),b.set("attemptedTransition",null)):b.transitionToRoute("profile",a)}},onLoginError:function(){var a=this;return function(b){a.set("msg_warning",b.responseJSON.error.message)}},actions:{linktoprofile:function(a){this._linkToProfile(a)},resetmsg:function(){var a=this;a.set("msg_warning",null)}}}),App.EmployeesController=App.PersonController.extend(),App.ManagersController=App.PersonController.extend(),App.ManadminsController=App.PersonController.extend(),App.EmpadminsController=App.PersonController.extend(),App.Person=DS.Model.extend(Ember.Validations.Mixin,{user_name:DS.attr("string"),password:DS.attr("string"),first_name:DS.attr("string"),last_name:DS.attr("string"),email:DS.attr("string"),position:DS.attr("string"),location:DS.attr("string"),phone_number:DS.attr("string"),roles:DS.attr("number"),preferred_locale:DS.attr("string"),created_at:DS.attr("date"),enabled:DS.attr("boolean"),picture:DS.attr("string"),direct_reports:DS.attr("string"),about:DS.attr("string"),role_none:0,role_user:1,role_manager:2,role_admin:4,role_systemadmin:8,hasFirstName:function(){return"undefined"!=typeof this.get("first_name")&&this.get("first_name").length>0}.property("first_name"),fullname:function(){return this.get("hasFirstName")?this.get("first_name")+" "+this.get("last_name"):this.get("last_name")}.property("first_name","last_name"),rowId:function(){return"listItem_"+this.get("id")}.property("id"),isEmployee:function(){return this.isInRole(this.role_user)}.property("roles"),isManager:function(){return this.isInRole(this.role_manager)}.property("roles"),isAdministrator:function(){return this.isInRole(this.role_admin)}.property("roles"),isManagerAdmin:function(){return this.isInRole(this.role_manager)&&this.isInRole(this.role_admin)}.property("roles"),isEmployeeAdmin:function(){return this.isInRole(this.role_user)&&this.isInRole(this.role_admin)}.property("roles"),isInRole:function(a){return(this.get("roles")&a)===a},pictureLink:function(){var a=App.normalizeRelativePath("/assets/person_40x40.png");return this.get("picture")&&""!==this.get("picture")?this.get("picture"):a}.property("picture")}),App.AuthenticatedRoute=Ember.Route.extend({beforeModel:function(a){App.get("session_token")||this.redirectToLogin(a)},redirectToLogin:function(a){var b=this.controllerFor("person");b.set("attemptedTransition",a),this.transitionTo("employees")},actions:{error:function(a,b){401===a.status&&this.redirectToLogin(b)}}}),App.PersonRoute=Ember.Route.extend({model:function(){return this.store.fetchAll("person")},renderTemplate:function(a){this.render("persons",{controller:a})},setupController:function(a){a.send("resetmsg"),a.set("employees",this._filterByRole(1)),a.set("managers",this._filterByRole(2)),a.set("managersadmins",this._filterByRole(6)),a.set("employeesadmins",this._filterByRole(5))},_filterByRole:function(a){var b=this;return b.store.filter("person",this._getFilterCallback(a))},_filterByRoleHelper:function(a,b){return a.get("roles")===b},_getFilterCallback:function(a){var b=this;return function(c){return b._filterByRoleHelper(c,a)}}}),App.ManagersRoute=App.PersonRoute.extend({setupController:function(a){this._super(a),a.set("model",a.managers)}}),App.ManadminsRoute=App.PersonRoute.extend({setupController:function(a){this._super(a),a.set("model",a.managersadmins)}}),App.EmployeesRoute=App.PersonRoute.extend({setupController:function(a){this._super(a),a.set("model",a.employees)}}),App.EmpadminsRoute=App.PersonRoute.extend({setupController:function(a){this._super(a),a.set("model",a.employeesadmins)}});